<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;font-family:"Cairo",Arial;
      background:linear-gradient(135deg,#0b1220,#020617);
      color:#e8eefc;min-height:100vh;padding:18px
    }
    .wrap{max-width:980px;margin:0 auto}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .pill{
      display:inline-block;padding:6px 10px;border-radius:999px;
      background:rgba(34,197,94,.16);border:1px solid rgba(34,197,94,.30)
    }
    .card{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;padding:16px;margin-top:14px;
      box-shadow:0 16px 36px rgba(0,0,0,.25)
    }
    .muted{color:#cdd7f3}
    .row{display:grid;grid-template-columns:1fr 170px 260px;gap:10px}
    @media (max-width:760px){.row{grid-template-columns:1fr}}
    label{display:block;margin:0 0 6px}
    input,button{font-family:"Cairo",Arial}
    input{
      width:100%;padding:12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.2);color:#e8eefc;outline:none
    }
    .btn{
      padding:12px 14px;border-radius:12px;border:0;
      background:#3b82f6;color:white;font-weight:700;cursor:pointer;
      width:100%;
    }
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn2{
      padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.22);
      background:transparent;color:#e8eefc;font-weight:700;cursor:pointer;
      width:100%;
    }
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.12);text-align:right}
    th{color:#dbe7ff}
    .total{font-size:18px;font-weight:700}
    .actions{display:flex;gap:10px;align-items:end}
    .smallbtn{
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.22);
      background:transparent;color:#e8eefc;font-weight:700;cursor:pointer
    }
    .success{color:#86efac}
    .danger{color:#fca5a5}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="pill">ğŸ§¾ ÙƒØ§Ø´ÙŠØ± (ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©)</div>
        <h2 style="margin:10px 0 0">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©</h2>
        <div class="muted">Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ù…Ù†ØªØ¬ ÙˆØ§Ø¶ØºØ· "Ø¨Ø­Ø«" Ø«Ù… "Ø¥Ø¶Ø§ÙØ©"</div>
      </div>
      <a href="./index.html" style="text-decoration:none">
        <button class="btn2" style="width:auto">â¬… Ø±Ø¬ÙˆØ¹</button>
      </a>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label class="muted">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
          <input id="code" placeholder="Ù…Ø«Ø§Ù„: 1001" inputmode="numeric" />
        </div>

        <div>
          <label class="muted">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
          <input id="qty" type="number" min="1" value="1" />
        </div>

        <div class="actions">
          <button class="btn2" id="findBtn" type="button">Ø¨Ø­Ø«</button>
          <button class="btn" id="addBtn" type="button" disabled>Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>

      <div style="margin-top:12px" class="muted" id="result">â€”</div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px">Ø§Ù„Ø³Ù„Ø©</h3>

      <table>
        <thead>
          <tr>
            <th>Ø§Ù„ÙƒÙˆØ¯</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>

        <tbody id="cartBody">
          <tr><td colspan="6" class="muted">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©</td></tr>
        </tbody>
      </table>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-top:12px">
        <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="grandTotal">0</span> Ø¬Ù†ÙŠÙ‡</div>
        <button class="btn" id="checkoutBtn" type="button" disabled style="width:auto">ØªØ£ÙƒÙŠØ¯ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</button>
      </div>

      <div class="muted" style="margin-top:8px">
        *Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ù‡Ù†Ø§ Ø¨ÙŠØ¹Ù…Ù„ ÙØ§ØªÙˆØ±Ø© â€œÙˆÙ‡Ù…ÙŠØ©â€ Ù„Ù„ØªØ¹Ù„Ù… ÙÙ‚Ø·.
      </div>
    </div>
  </div>

  <script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø© (Ù‡Ù†Ø¨Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ù€ Supabase)
    const PRODUCTS = {
      "1001": { name: "ÙÙ„ØªØ± Ø²ÙŠØª", price: 85 },
      "1002": { name: "ÙÙ„ØªØ± Ù‡ÙˆØ§", price: 120 },
      "2001": { name: "Ø¨ÙˆØ¬ÙŠÙ‡", price: 55 },
      "3001": { name: "Ø²ÙŠØª Ù…ÙˆØªÙˆØ± 1L", price: 180 },
    };

    let selected = null;
    let cart = [];

    const codeEl = document.getElementById("code");
    const qtyEl = document.getElementById("qty");
    const resultEl = document.getElementById("result");
    const addBtn = document.getElementById("addBtn");
    const cartBody = document.getElementById("cartBody");
    const grandTotalEl = document.getElementById("grandTotal");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const findBtn = document.getElementById("findBtn");

    function money(n){ return Number(n).toFixed(0); }

    function showMessage(html, ms = 2000){
      resultEl.innerHTML = html;
      if(ms > 0){
        setTimeout(() => { resultEl.textContent = "â€”"; }, ms);
      }
    }

    function renderCart(){
      cartBody.innerHTML = "";

      if(cart.length === 0){
        cartBody.innerHTML = '<tr><td colspan="6" class="muted">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©</td></tr>';
        grandTotalEl.textContent = "0";
        checkoutBtn.disabled = true;
        return;
      }

      let grand = 0;

      cart.forEach((item, idx) => {
        const line = item.price * item.qty;
        grand += line;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.code}</td>
          <td>${item.name}</td>
          <td>${money(item.price)}</td>
          <td>${item.qty}</td>
          <td>${money(line)}</td>
          <td><button class="smallbtn" data-i="${idx}" type="button">Ø­Ø°Ù</button></td>
        `;
        cartBody.appendChild(tr);
      });

      grandTotalEl.textContent = money(grand);
      checkoutBtn.disabled = false;

      cartBody.querySelectorAll("button[data-i]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = Number(btn.getAttribute("data-i"));
          cart.splice(i, 1);
          renderCart();
          showMessage('<span class="success">ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…</span>', 1200);
        });
      });
    }

    function doFind(){
      const code = (codeEl.value || "").trim();
      const p = PRODUCTS[code];

      if(!p){
        selected = null;
        addBtn.disabled = true;
        showMessage('<span class="danger">âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</span> â€” Ø¬Ø±Ù‘Ø¨: 1001 / 1002 / 2001 / 3001', 2500);
        return;
      }

      selected = { code, ...p };
      addBtn.disabled = false;
      showMessage(`<span class="success">âœ… ${p.name}</span> â€” Ø§Ù„Ø³Ø¹Ø±: ${money(p.price)} Ø¬Ù†ÙŠÙ‡`, 0);
    }

    findBtn.addEventListener("click", doFind);

    // Enter ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¹Ù…Ù„ "Ø¨Ø­Ø«"
    codeEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        doFind();
      }
    });

    addBtn.addEventListener("click", () => {
      if(!selected) return;

      const qty = Math.max(1, Number(qtyEl.value || 1));

      const existing = cart.find(x => x.code === selected.code);
      if(existing){
        existing.qty += qty;
      }else{
        cart.push({ code: selected.code, name: selected.name, price: selected.price, qty });
      }

      renderCart();

      // ØªØ­Ø³ÙŠÙ†Ø§Øª: Ø±Ø³Ø§Ù„Ø© ØªØ®ØªÙÙŠ + ØªÙ†Ø¸ÙŠÙ + Ù…Ù†Ø¹ Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„ØºÙ„Ø·
      showMessage('<span class="success">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…</span>', 2000);

      codeEl.value = "";
      qtyEl.value = "1";
      selected = null;
      addBtn.disabled = true;
      codeEl.focus();
    });

    checkoutBtn.addEventListener("click", () => {
      const invoiceId = "INV-" + Math.floor(Math.random() * 90000 + 10000);
      alert("âœ… ØªÙ… (ØªØ¬Ø±ÙŠØ¨ÙŠ) Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©: " + invoiceId + "\nØ¥Ø¬Ù…Ø§Ù„ÙŠ: " + grandTotalEl.textContent + " Ø¬Ù†ÙŠÙ‡");
      cart = [];
      renderCart();
      resultEl.textContent = "â€”";
      codeEl.value = "";
      qtyEl.value = "1";
      addBtn.disabled = true;
      codeEl.focus();
    });

    renderCart();
  </script>
</body>
</html> 
