<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;font-family:"Cairo",Arial;
      background:linear-gradient(135deg,#0b1220,#020617);
      color:#e8eefc;min-height:100vh;padding:18px
    }
    .wrap{max-width:980px;margin:0 auto}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .pill{
      display:inline-block;padding:6px 10px;border-radius:999px;
      background:rgba(59,130,246,.16);border:1px solid rgba(59,130,246,.30)
    }
    .card{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;padding:16px;margin-top:14px;
      box-shadow:0 16px 36px rgba(0,0,0,.25)
    }
    .muted{color:#cdd7f3}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    @media (max-width:860px){.row{grid-template-columns:1fr}}
    label{display:block;margin:0 0 6px}
    input,button{font-family:"Cairo",Arial}
    input{
      width:100%;padding:12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.2);color:#e8eefc;outline:none
    }
    .btn{
      padding:12px 14px;border-radius:12px;border:0;
      background:#3b82f6;color:white;font-weight:700;cursor:pointer;
    }
    .btn2{
      padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.22);
      background:transparent;color:#e8eefc;font-weight:700;cursor:pointer;
    }
    .btn:disabled{opacity:.55;cursor:not-allowed}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.12);text-align:right;vertical-align:top}
    th{color:#dbe7ff}
    .smallbtn{
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.22);
      background:transparent;color:#e8eefc;font-weight:700;cursor:pointer
    }
    .success{color:#86efac}
    .danger{color:#fca5a5}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .bar .left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .hint{
      font-size:13px;line-height:1.7;color:#b7c4e8;
      border:1px dashed rgba(255,255,255,.18);
      padding:10px;border-radius:12px;
      background:rgba(0,0,0,.18)
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="pill">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©)</div>
        <h2 style="margin:10px 0 0">Products</h2>
        <div class="muted">Ù‡Ù†Ø§ Ø¨ØªØ¶ÙŠÙ/ØªØ¹Ø¯Ù„/ØªØ­Ø°Ù Ù…Ù†ØªØ¬Ø§ØªØŒ ÙˆØ¨Ø¹Ø¯ÙŠÙ† ØªÙØªØ­ Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª â€œÙ…Ù† ØºÙŠØ± ØªØ®Ø²ÙŠÙ†â€.</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a href="./index.html" style="text-decoration:none"><button class="btn2">â¬… Ø±Ø¬ÙˆØ¹</button></a>
        <a id="openCashierA" href="./cashier.html" style="text-decoration:none"><button class="btn">Ø§ÙØªØ­ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button></a>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label class="muted">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
          <input id="code" placeholder="Ù…Ø«Ø§Ù„: 1001" inputmode="numeric">
        </div>
        <div>
          <label class="muted">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
          <input id="name" placeholder="Ù…Ø«Ø§Ù„: ÙÙ„ØªØ± Ø²ÙŠØª">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø³Ø¹Ø±</label>
          <input id="price" placeholder="Ù…Ø«Ø§Ù„: 85" inputmode="numeric">
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <button id="addBtn" class="btn">Ø¥Ø¶Ø§ÙØ© / ØªØ­Ø¯ÙŠØ«</button>
        <button id="clearBtn" class="btn2">Ù…Ø³Ø­ Ø§Ù„Ø®Ø§Ù†Ø§Øª</button>
      </div>

      <div id="msg" class="muted" style="margin-top:10px">â€”</div>

      <div class="hint" style="margin-top:12px">
        âœ… Ø¨Ø¯ÙˆÙ† LocalStorage: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <b>Ù‡ØªØ®ØªÙÙŠ</b> Ù„Ùˆ Ø¹Ù…Ù„Øª Refresh Ù„Ù„ØµÙØ­Ø©. <br>
        âœ… Ø§Ù„Ø­Ù„: Ø§Ø¶ØºØ· â€œØ§ÙØªØ­ Ø§Ù„ÙƒØ§Ø´ÙŠØ±â€ Ø¹Ø´Ø§Ù† ÙŠÙØªØ­ ÙˆÙ…Ø¹Ø§Ù‡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù„ÙŠÙ†Ùƒ.
      </div>
    </div>

    <div class="card">
      <div class="bar">
        <div class="left">
          <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
          <span class="muted" id="count">0</span>
        </div>
        <div class="left">
          <input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯..." style="min-width:240px">
          <button id="copyLinkBtn" class="btn2">Ù†Ø³Ø® Ù„ÙŠÙ†Ùƒ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ø§Ù„ÙƒÙˆØ¯</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="4" class="muted">Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª Ù„Ø³Ù‡</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Ù…Ù†ØªØ¬Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙƒØ¨Ø¯Ø§ÙŠØ© (ØªÙ‚Ø¯Ø± ØªÙ…Ø³Ø­Ù‡Ù… Ø£Ùˆ ØªØ¹Ø¯Ù„Ù‡Ù…)
    let products = [
      { code: "1001", name: "ÙÙ„ØªØ± Ø²ÙŠØª", price: 85 },
      { code: "1002", name: "ÙÙ„ØªØ± Ù‡ÙˆØ§", price: 120 },
      { code: "2001", name: "Ø¨ÙˆØ¬ÙŠÙ‡", price: 55 },
      { code: "3001", name: "Ø²ÙŠØª Ù…ÙˆØªÙˆØ± 1L", price: 180 },
    ];

    const codeEl = document.getElementById("code");
    const nameEl = document.getElementById("name");
    const priceEl = document.getElementById("price");
    const msgEl = document.getElementById("msg");
    const tbody = document.getElementById("tbody");
    const countEl = document.getElementById("count");
    const searchEl = document.getElementById("search");
    const openCashierA = document.getElementById("openCashierA");
    const copyLinkBtn = document.getElementById("copyLinkBtn");

    function show(html, ms=1500){
      msgEl.innerHTML = html;
      if(ms>0) setTimeout(()=> msgEl.textContent="â€”", ms);
    }

    function money(n){ return Number(n).toFixed(0); }

    function encodeProductsForUrl(list){
      const json = JSON.stringify(list);
      const base64 = btoa(unescape(encodeURIComponent(json)));
      return base64;
    }

    function cashierUrl(){
      const encoded = encodeProductsForUrl(products);
      return "./cashier.html?products=" + encodeURIComponent(encoded);
    }

    function syncCashierLink(){
      openCashierA.setAttribute("href", cashierUrl());
    }

    function render(){
      const q = (searchEl.value || "").trim().toLowerCase();
      const filtered = products.filter(p =>
        p.code.toLowerCase().includes(q) || p.name.toLowerCase().includes(q)
      );

      countEl.textContent = filtered.length;

      tbody.innerHTML = "";
      if(filtered.length === 0){
        tbody.innerHTML = '<tr><td colspan="4" class="muted">Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</td></tr>';
      } else {
        filtered.forEach((p, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.code}</td>
            <td>${p.name}</td>
            <td>${money(p.price)}</td>
            <td style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="smallbtn" data-edit="${p.code}">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="smallbtn" data-del="${p.code}">Ø­Ø°Ù</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      tbody.querySelectorAll("button[data-edit]").forEach(btn => {
        btn.addEventListener("click", () => {
          const code = btn.getAttribute("data-edit");
          const p = products.find(x => x.code === code);
          if(!p) return;
          codeEl.value = p.code;
          nameEl.value = p.name;
          priceEl.value = p.price;
          show('<span class="success">âœ… Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ«</span>', 1800);
        });
      });

      tbody.querySelectorAll("button[data-del]").forEach(btn => {
        btn.addEventListener("click", () => {
          const code = btn.getAttribute("data-del");
          products = products.filter(x => x.code !== code);
          show('<span class="success">ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…</span>', 1200);
          syncCashierLink();
          render();
        });
      });

      syncCashierLink();
    }

    document.getElementById("addBtn").addEventListener("click", () => {
      const code = (codeEl.value || "").trim();
      const name = (nameEl.value || "").trim();
      const price = Number((priceEl.value || "").trim());

      if(!code || !name || !Number.isFinite(price) || price <= 0){
        show('<span class="danger">âŒ Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ + Ø§Ø³Ù… + Ø³Ø¹Ø± ØµØ­ÙŠØ­</span>', 2000);
        return;
      }

      const existing = products.find(x => x.code === code);
      if(existing){
        existing.name = name;
        existing.price = price;
        show('<span class="success">âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«</span>', 1200);
      } else {
        products.push({ code, name, price });
        show('<span class="success">âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©</span>', 1200);
      }

      codeEl.value = "";
      nameEl.value = "";
      priceEl.value = "";
      syncCashierLink();
      render();
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      codeEl.value = "";
      nameEl.value = "";
      priceEl.value = "";
      show("ØªÙ… âœ…", 800);
    });

    searchEl.addEventListener("input", render);

    copyLinkBtn.addEventListener("click", async () => {
      const link = cashierUrl();
      try{
        await navigator.clipboard.writeText(new URL(link, location.href).toString());
        show('<span class="success">âœ… ØªÙ… Ù†Ø³Ø® Ù„ÙŠÙ†Ùƒ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</span>', 1500);
      }catch(e){
        show('<span class="danger">âŒ Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø®. Ø§ÙØªØ­ Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ù…Ù† Ø²Ø± "Ø§ÙØªØ­ Ø§Ù„ÙƒØ§Ø´ÙŠØ±".</span>', 2200);
      }
    });

    render();
  </script>
</body>
</html>
